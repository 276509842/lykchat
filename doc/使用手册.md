# lykchat工作流程
![lykchat工作流程](https://raw.githubusercontent.com/lykops/lykchat/master/doc/lykchat工作流程.jpg)


# 模块说明

## 管理web页面
	可视化管理微信个人号
	包括：
		用户登录和认证
		微信号登陆管理：负责微信登陆、登陆信息展示等功能
		发送信息给好友：用于测试发送功能是否可用
			通过选择好友列表显示获取需要发送信息的好友
			好友信息列表只展示文件传输助手、除了自己外的好友（疑似好友表示没有设置该好友没有设置性别）、部分群（是根据第一页好友信息获取的），自动屏蔽掉公众号、微信系统用户、好友为自己。
## 发送信息接口
	通过接口方式为其他业务系统发送信息给指定好友
	URL地址：http://IP（或者域名）/sendmsg
	支持post和get方法
	请求参数说明：
		'username' : 管理用户，同管理web页面，通过用户确认微信发送者
		'pwd' : 接口密码，注意不等于登陆密码
		'friendfield'：接受信息的好友字段代号，{0:"NickName" , 1:"Alias" , 2:"RemarkName"}，可以为空，默认为0
		'friend': 接受信息的好友的昵称、微信号、备注名的其中之一，不能为空
		'content': 发送内容，不能为空
		注意：
			friend一定是该用户下的登陆微信好友列表中的
			friendfield最好是微信号（Alias），也可以使用昵称（NickName）或者备注名（RemarkName），但不能重复
	返回信息：
		json格式，{'Msg': 执行结果, 'Code':返回代码, 'ErrMsg':如果-1005返回参数列表，其他发送微信返回信息}
		常见code：0成功，-1101参数错误，-1102无法找到好友，1101微信号退出登录，其他为微信返回错误
	例子：http://192.168.100.104/sendmsg?username=zabbix&pwd=123456&friendfield=1&friend=lyk-ops&content=test
## 计划任务
	检测微信登陆状态：
		获取所有登录微信成功的用户，通过调用检测微信登陆接口
## 会话保持模块
	存储微信登陆信息和会话信息，同用户在任何地方登陆，保证微信登陆状态一致
	访问管理页面和微信登陆检测接口，根据session或者参数获取用户名，然后读取会话文件，页面操作后，再一次更新数据库和会话文件

	这些信息分别保持在数据库和文件中。
	数据库
		保存用户会话信息，只记录用户名
		有效期1小时
		每次访问更新会话有效期
		会自动删除过期的会话信息
	会话文件
		保存用户所有的信息（包括微信登陆信息）
		json格式
		每次访问更新
		默认存放在/dev/shm/lykchat下，根据用户名命名
## 模拟微信web端模块
	它是该系统的核心和底层模块。
	通过微信登陆信息，访问微信web端接口，实现管理登陆、发送信息等功能。
	
